AUI.add("aui-image-cropper",function(b){var f=b.Lang,a=f.isBoolean,g=f.isNumber,i="image-cropper",c=b.getClassName(i,"border"),e=b.getClassName(i,"crop"),d=b.getClassName(i,"overlay");CSS_OVERLAY_HOVER=b.getClassName(i,"crop","hover");var h=b.Component.create({NAME:i,ATTRS:{cropHeight:{value:100,validator:g},cropWidth:{value:100,validator:g},minWidth:{value:undefined},minHeight:{value:undefined},movable:{value:true,validator:a},preserveRatio:{value:false,validator:a},resizable:{value:true,validator:a},x:{value:0,validator:g},y:{value:0,validator:g}},UI_ATTRS:["cropHeight","cropWidth","minWidth","minHeight","movable","resizable","x","y"],prototype:{renderUI:function(){var j=this;var k=j.get("boundingBox");var l=j.get("srcNode");j.cropNode=b.Node.create('<div class="'+e+'"></div>');j.topOverlay=b.Node.create('<div class="'+d+'"></div>');j.rightOverlay=b.Node.create('<div class="'+d+'"></div>');j.bottomOverlay=b.Node.create('<div class="'+d+'"></div>');j.leftOverlay=b.Node.create('<div class="'+d+'"></div>');j.borderNode=b.Node.create('<div class="'+c+'"></div>');b.all([j.cropNode,j.topOverlay,j.rightOverlay,j.bottomOverlay,j.leftOverlay,j.borderNode]).appendTo(k);j._boundingBox=k;j._renderDrag();j._renderResize();j._unHoverOverlay();},bindUI:function(){var j=this;j.drag.addTarget(j);j.resize.addTarget(j);j.on(["drag:drag","resize:resize"],j._positionOverlay);j.on(["drag:start","resize:start"],j._hoverOverlay);j.on(["drag:end","resize:end"],j._unHoverOverlay);j.cropNode.hover(b.bind(j._hoverOverlay,j),b.bind(j._unHoverOverlay,j));},syncUI:function(){var l=this;var p=l.get("srcNode");var k=p.height();var n=p.width();var m=l.get("cropHeight");var o=l.get("cropWidth");var j=l.get("x");var q=l.get("y");if(q<0){q=0;}if(q+m>k){q=Math.max(k-m,0);}l.set("y",q);if(q+m>k){m=Math.max(k-q,0);}l.set("cropHeight",m);if(j<0){j=0;}if(j+o>n){j=Math.max(n-o,0);}l.set("x",j);if(j+o>n){o=Math.max(n-j,0);}l.set("cropWidth",o);l._uiSetPreserveRatio(l.get("preserveRatio"));},destructor:function(){var j=this;j._destroyDrag();j._destroyResize();},getCropRegion:function(){var q=this;var o=q.get("srcNode");var p=q.cropNode;var k=o.width();var j=o.height();var n=p.width();var r=p.height();var m=p.getX()-o.getX();var l=p.getY()-o.getY();m=Math.round(m);l=Math.round(l);m=Math.max(0,m);l=Math.max(0,l);m=Math.min(m,k);l=Math.min(l,j);if(m+n>k){n=k-m;}if(l+r>j){r=j-l;}return{x:m,y:l,width:n,height:r};},_destroyDrag:function(k){var j=this;if(j.drag){j.drag.destroy();delete j.drag;}},_destroyResize:function(k){var j=this;if(j.resize){j.resize.destroy();delete j.resize;}},_hoverOverlay:function(){var j=this;if(!j._isDragging()&&!j._isResizing()){j._boundingBox.addClass(CSS_OVERLAY_HOVER);}},_isDragging:function(){var j=this;var k=j.drag;return k&&k.get("dragging");},_isResizing:function(){var j=this;var k=j.resize;return k&&k.get("resizing");},_positionOverlay:function(A){var C=this;var s=C.get("srcNode");var v=C.borderNode;var z=C.cropNode;var n=C.topOverlay;var o=C.rightOverlay;var B=C.bottomOverlay;var r=C.leftOverlay;var p=s.getXY();var l=p[0];var j=p[1];var q=s.width();var D=s.height();var x=C.getCropRegion();var y=x.x;var w=x.y;var u=y+l;var t=w+j;var k=x.width;var m=x.height;n.setXY([l,j]);n.width(q);n.height(w);o.setXY([u+k,t]);o.width(q-(y+k));o.height(m);B.setXY([l,t+m]);B.width(q);B.height(D-(w+m));r.setXY([l,t]);r.width(y);r.height(m);v.setXY([u-v.getBorderWidth("l"),t-v.getBorderWidth("t")]);v.width(k);v.height(m);},_renderDrag:function(){var j=this;var k=new b.DD.Drag({node:j.cropNode}).plug(b.Plugin.DDConstrained,{constrain2node:j.get("srcNode")});j.drag=k;},_renderResize:function(){var j=this;var m=j.get("srcNode");var l=j.cropNode;var k=new b.Resize({node:l}).plug(b.Plugin.ResizeConstrained,{constrain:m,preserveRatio:j.get("preserveRatio"),minHeight:j.get("minHeight"),minWidth:j.get("minWidth")});j.resize=k;},_uiSetCropHeight:function(k){var j=this;j.cropNode.height(k);j._positionOverlay();},_uiSetCropWidth:function(k){var j=this;j.cropNode.width(k);j._positionOverlay();},_uiSetMinHeight:function(l){var j=this;var k=j.resize;if(k){k.con.set("minHeight",l);}},_uiSetMinWidth:function(l){var j=this;var k=j.resize;if(k){k.con.set("minWidth",l);}},_uiSetMovable:function(k){var j=this;j.drag.set("lock",!k);},_uiSetPreserveRatio:function(l){var j=this;var k=j.resize;if(k){k.con.set("preserveRatio",l);}},_uiSetResizable:function(k){var j=this;if(k){if(j.stopResize){j.stopResize.detach();}}else{if(!j.stopResize){j.stopResize=j.resize.on("resize:resize",function(l){l.preventDefault();l.stopPropagation();});}}},_uiSetX:function(m){var j=this;var n=j.get("srcNode");var k=j.cropNode;var l=n.getX();k.setX(l+m);j._positionOverlay();},_uiSetY:function(m){var j=this;var n=j.get("srcNode");var k=j.cropNode;var l=n.getY();k.setY(l+m);j._positionOverlay();},_unHoverOverlay:function(){var j=this;if(!j._isDragging()&&!j._isResizing()){j._boundingBox.removeClass(CSS_OVERLAY_HOVER);}}}});b.ImageCropper=h;},"@VERSION@",{skinnable:true,requires:["widget","aui-base","resize","dd-constrain"]});